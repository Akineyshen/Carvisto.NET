@* Views/Drivers/Details.cshtml *@
@model Carvisto.Models.ViewModels.DriverDetailsViewModel

@{
    ViewData["Title"] = "Driver";
}

<div class="driver-container">
    <div class="page-header">
        <a asp-action="Index" class="btn-back">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0m3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z"/>
            </svg>
            Back
        </a>
        <h2 class="page-title">Driver's profile</h2>
    </div>

    <div class="driver-profile">
        <div class="profile-card">
            <div class="driver-image-container">
                @if (!string.IsNullOrEmpty(Model.Driver.ProfileImagePath))
                {
                    <img src="@Model.Driver.ProfileImagePath" alt="Profile Image" class="driver-image-details" />
                }
                else
                {
                    <img src="/images/profiles/default.png" alt="Default Profile Image" class="driver-image-details" />
                }
            </div>
        </div>

        <div class="profile-card info-card">
            <div class="info-header">
                <h3 class="driver-name">@Model.Driver.ContactName</h3>
            </div>
            <div class="info-content">
                <div class="info-item">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>
                        </svg>
                    </div>
                    <div>
                        <span class="info-label">Email:</span>
                        <span class="info-value">@Model.Driver.Email</span>
                    </div>
                </div>

                <div class="info-item">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z"/>
                        </svg>
                    </div>
                    <div>
                        <span class="info-label">Phone:</span>
                        <span class="info-value">@Model.Driver.ContactPhone</span>
                    </div>
                </div>

                <div class="info-item">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z"/>
                        </svg>
                    </div>
                    <div>
                        <span class="info-label">Number of trips:</span>
                        <span class="info-value">@Model.Trips.Count()</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="section-header">
        <h3 class="section-title">Driver's trips</h3>
    </div>
    <div class="trip-grid">
        @foreach (var trip in Model.Trips)
        {
            <div class="trip-card">
                <div class="trip-card-header">
                    <div class="trip-route">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                        </svg>
                        @trip.StartLocation ➞ @trip.EndLocation
                    </div>
                </div>
                <div class="trip-details">
                    <div class="trip-info-item">
                        <svg class="trip-info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        @trip.DepartureDateTime.ToString("MMM dd HH:mm")
                    </div>
                    <div class="trip-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="trip-info-icon" viewBox="0 0 16 16">
                            <path d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z"/>
                        </svg>
                        @trip.VehicleBrand
                    </div>
                    <div class="trip-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                            <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                        </svg>
                        Available Seats: @trip.AvailableSeats
                    </div>
                </div>
                <div class="trip-price">
                    <div>
                        <div class="price-value">@trip.Price.ToString("0.##") PLN</div>
                        <div class="price-per-seat">per seat</div>
                    </div>
                    <a asp-action="Details" asp-controller="Trips" asp-route-id="@trip.Id" class="view-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                            <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
                        </svg>
                        <span>View</span>
                    </a>
                </div>
            </div>
        }
    </div>
    
    <div class="reviews-section">
    <div class="rating-summary">
        <div class="section-header">
            <h3 class="section-title">Driver reviews (@Model.ReviewsCount)</h3>
        </div>
        <div class="rating-stats">
            <div class="rating-stats-item">
                <div class="average-rating">Rating: @Model.AverageRating.ToString("F1")</div>
                <div class="stars">
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= Math.Round(Model.AverageRating))
                        {
                            <span class="star filled">⭐</span>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    @if (Model.CanLeaveReview)
    {
        <div class="add-review-form">
            <h4 class="title-review">Leave a review</h4>
            <form asp-action="AddReview" asp-controller="Drivers" asp-route-driverId="@Model.Driver.Id" method="post" class="review-form">
                @Html.AntiForgeryToken()
                <div class="rating-input">
                    <div class="">Select the number of stars: </div>
                    @for (int i = 5; i >= 1; i--)
                    {
                        <input type="radio" id="star@(i)" name="Rating" value="@i" class="checkmark-review" required/>
                        <label for="star@(i)">@i⭐</label>
                    }
                </div>
                <div class="form-group">
                    <textarea name="Comment" class="form-input trip-textarea" placeholder="Write your review..." required maxlength="500"></textarea>
                </div>
                <div class="action-review">
                    <button type="submit" class="btn-add-review">Send review</button>
                </div>
            </form>
        </div>
    }

    <div class="reviews-list">
        @foreach (var review in Model.Reviews)
        {
            <div class="review-item">
                <div class="review-header-item">
                    <div class="review-header">
                        @if (!string.IsNullOrEmpty(review.Reviewer.ProfileImagePath))
                        {
                            <img src="@review.Reviewer.ProfileImagePath" alt="Profile Image" class="detail-reviewer-img" onerror="this.onerror=null; this.src='/images/driver_default.png';"/>
                        }
                        else
                        {
                            <img src="/images/profiles/default.png" alt="Profile Image" class="detail-reviewer-img"/>
                        }
                        <div class="review-header-info">
                            <div class="reviewer-name">@review.Reviewer.ContactName</div>
                            <div class="review-rating">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= review.Rating)
                                    {
                                        <span class="star filled">⭐</span>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="review-date">@review.CreatedAt.ToString("dd.MM.yyyy")</div>
                </div>
                <div class="review-comment">
                    @review.Comment
                </div>
                @if (review.CanDelete)
                {
                    <form asp-action="DeleteReview" asp-controller="Drivers" method="post" class="delete-review">
                        <input type="hidden" name="reviewId" value="@review.Id"/>
                        @Html.AntiForgeryToken()
                        <button type="submit" class="delete-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>
                            </svg>
                        </button>
                    </form>
                }
            </div>
        }
    </div>
</div>
</div>
